<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Result Management</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>ðŸŽ“ Student Result Management</h1>

    <!-- Add Student -->
    <section class="card">
      <h2>Add Student</h2>
      <form method="POST" class="grid">
        <input type="text" name="name" placeholder="Name" required>
        <input type="text" name="roll" placeholder="Roll No (unique)" required>
        <input type="number" step="0.01" name="m1" placeholder="Marks - Subject 1" required>
        <input type="number" step="0.01" name="m2" placeholder="Marks - Subject 2" required>
        <input type="number" step="0.01" name="m3" placeholder="Marks - Subject 3" required>
        <button type="submit">Add</button>
      </form>
      <p class="hint">Marks are out of 100 for each subject. Grade/Result calculated automatically.</p>
    </section>

    <!-- Filters -->
    <section class="card">
      <h2>Filter & Sort</h2>
      <form method="GET" class="filters">
        <input type="text" name="name" placeholder="Search by name" value="{{ filters.name }}">
        <input type="number" step="0.01" name="min_percent" placeholder="Min %" value="{{ filters.min_percent }}">
        <input type="number" step="0.01" name="max_percent" placeholder="Max %" value="{{ filters.max_percent }}">
        <select name="result">
          <option value="">Result: Any</option>
          <option value="PASS" {% if filters.result == 'PASS' %}selected{% endif %}>PASS</option>
          <option value="FAIL" {% if filters.result == 'FAIL' %}selected{% endif %}>FAIL</option>
        </select>
        <select name="sort">
          <option value="">Sort: Latest</option>
          <option value="percent_asc"  {% if filters.sort == 'percent_asc' %}selected{% endif %}>% Low â†’ High</option>
          <option value="percent_desc" {% if filters.sort == 'percent_desc' %}selected{% endif %}>% High â†’ Low</option>
          <option value="name_asc"     {% if filters.sort == 'name_asc' %}selected{% endif %}>Name A â†’ Z</option>
          <option value="name_desc"    {% if filters.sort == 'name_desc' %}selected{% endif %}>Name Z â†’ A</option>
        </select>
        <button type="submit">Apply</button>
        <a class="secondary" href="{{ url_for('index') }}">Reset</a>
      </form>

      <div class="stats">
        <span><strong>Total (view):</strong> {{ total_students }}</span>
        <span><strong>Avg % (view):</strong> {{ avg_percent }}</span>
      </div>
    </section>

    <!-- Table -->
    <section class="card">
      <h2>Students</h2>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Roll</th>
              <th>S1</th>
              <th>S2</th>
              <th>S3</th>
              <th>Total</th>
              <th>%</th>
              <th>Grade</th>
              <th>Result</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
          {% for s in students %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ s.name }}</td>
              <td>{{ s.roll }}</td>
              <td>{{ '%.2f'|format(s.m1) }}</td>
              <td>{{ '%.2f'|format(s.m2) }}</td>
              <td>{{ '%.2f'|format(s.m3) }}</td>
              <td>{{ '%.2f'|format(s.total) }}</td>
              <td>{{ '%.2f'|format(s.percent) }}</td>
              <td>{{ s.grade }}</td>
              <td class="{{ 'pass' if s.result=='PASS' else 'fail' }}">{{ s.result }}</td>
              <td><a class="danger" href="{{ url_for('delete', student_id=s.id) }}" onclick="return confirm('Delete this record?');">Delete</a></td>
            </tr>
          {% else %}
            <tr><td colspan="11">No records yet.</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </section>
  </div>
</body>
</html>
